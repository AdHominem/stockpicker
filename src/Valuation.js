import './App.css';
import {useEffect} from "react";

const pricesBABA = {
    "Meta Data": {
        "1. Information": "Monthly Prices (open, high, low, close) and Volumes",
        "2. Symbol": "baba",
        "3. Last Refreshed": "2021-04-30",
        "4. Time Zone": "US/Eastern"
    },
    "Monthly Time Series": {
        "2021-04-30": {
            "1. open": "230.6800",
            "2. high": "245.6900",
            "3. low": "221.3200",
            "4. close": "230.9500",
            "5. volume": "329065608"
        },
        "2021-03-31": {
            "1. open": "241.0500",
            "2. high": "242.7900",
            "3. low": "220.4200",
            "4. close": "226.7300",
            "5. volume": "375518718"
        },
        "2021-02-26": {
            "1. open": "258.8000",
            "2. high": "274.2900",
            "3. low": "237.6500",
            "4. close": "237.7600",
            "5. volume": "299885907"
        },
        "2021-01-29": {
            "1. open": "226.5000",
            "2. high": "269.0000",
            "3. low": "220.0900",
            "4. close": "253.8300",
            "5. volume": "493213157"
        },
        "2020-12-31": {
            "1. open": "265.4700",
            "2. high": "271.3000",
            "3. low": "211.2300",
            "4. close": "232.7300",
            "5. volume": "573851914"
        },
        "2020-11-30": {
            "1. open": "310.9500",
            "2. high": "311.4400",
            "3. low": "252.5500",
            "4. close": "263.3600",
            "5. volume": "584373494"
        },
        "2020-10-30": {
            "1. open": "295.2600",
            "2. high": "319.3200",
            "3. low": "284.8800",
            "4. close": "304.6900",
            "5. volume": "278228669"
        },
        "2020-09-30": {
            "1. open": "289.2000",
            "2. high": "299.0000",
            "3. low": "264.5600",
            "4. close": "293.9800",
            "5. volume": "235282442"
        },
        "2020-08-31": {
            "1. open": "254.0200",
            "2. high": "292.4800",
            "3. low": "246.1000",
            "4. close": "287.0300",
            "5. volume": "309700272"
        },
        "2020-07-31": {
            "1. open": "215.8100",
            "2. high": "268.0000",
            "3. low": "214.7400",
            "4. close": "251.0200",
            "5. volume": "425984465"
        },
        "2020-06-30": {
            "1. open": "205.9000",
            "2. high": "231.0300",
            "3. low": "203.9400",
            "4. close": "215.7000",
            "5. volume": "333902903"
        },
        "2020-05-29": {
            "1. open": "195.7500",
            "2. high": "221.1574",
            "3. low": "189.5300",
            "4. close": "207.3900",
            "5. volume": "503534951"
        },
        "2020-04-30": {
            "1. open": "189.5000",
            "2. high": "216.1000",
            "3. low": "185.0400",
            "4. close": "202.6700",
            "5. volume": "329072096"
        },
        "2020-03-31": {
            "1. open": "208.5900",
            "2. high": "215.1500",
            "3. low": "169.9500",
            "4. close": "194.4800",
            "5. volume": "439406831"
        },
        "2020-02-28": {
            "1. open": "208.6700",
            "2. high": "226.7000",
            "3. low": "198.5610",
            "4. close": "208.0000",
            "5. volume": "327996441"
        },
        "2020-01-31": {
            "1. open": "216.6000",
            "2. high": "231.1400",
            "3. low": "199.5000",
            "4. close": "206.5900",
            "5. volume": "302997673"
        },
        "2019-12-31": {
            "1. open": "198.5800",
            "2. high": "218.1100",
            "3. low": "189.8500",
            "4. close": "212.1000",
            "5. volume": "300669495"
        },
        "2019-11-29": {
            "1. open": "179.0100",
            "2. high": "200.9800",
            "3. low": "176.0600",
            "4. close": "200.0000",
            "5. volume": "408589636"
        },
        "2019-10-31": {
            "1. open": "168.0100",
            "2. high": "179.6400",
            "3. low": "161.6800",
            "4. close": "176.6700",
            "5. volume": "261159493"
        },
        "2019-09-30": {
            "1. open": "173.0000",
            "2. high": "184.1300",
            "3. low": "163.1500",
            "4. close": "167.2300",
            "5. volume": "246984447"
        },
        "2019-08-30": {
            "1. open": "174.5400",
            "2. high": "178.8000",
            "3. low": "151.8500",
            "4. close": "175.0300",
            "5. volume": "405012202"
        },
        "2019-07-31": {
            "1. open": "175.8650",
            "2. high": "179.8800",
            "3. low": "165.0000",
            "4. close": "173.1100",
            "5. volume": "356339925"
        },
        "2019-06-28": {
            "1. open": "149.6000",
            "2. high": "171.9800",
            "3. low": "148.8450",
            "4. close": "169.4500",
            "5. volume": "431888593"
        },
        "2019-05-31": {
            "1. open": "186.7500",
            "2. high": "195.7200",
            "3. low": "147.9500",
            "4. close": "149.2600",
            "5. volume": "511793591"
        },
        "2019-04-30": {
            "1. open": "185.0900",
            "2. high": "189.7900",
            "3. low": "176.7600",
            "4. close": "185.5700",
            "5. volume": "260691920"
        },
        "2019-03-29": {
            "1. open": "185.0900",
            "2. high": "188.0800",
            "3. low": "171.5650",
            "4. close": "182.4500",
            "5. volume": "233498823"
        },
        "2019-02-28": {
            "1. open": "168.0000",
            "2. high": "184.9300",
            "3. low": "163.7500",
            "4. close": "183.0300",
            "5. volume": "223664541"
        },
        "2019-01-31": {
            "1. open": "134.1300",
            "2. high": "169.7300",
            "3. low": "129.8300",
            "4. close": "168.4900",
            "5. volume": "361426233"
        },
        "2018-12-31": {
            "1. open": "168.6400",
            "2. high": "168.8000",
            "3. low": "129.7700",
            "4. close": "137.0700",
            "5. volume": "344562766"
        },
        "2018-11-30": {
            "1. open": "144.9800",
            "2. high": "160.8600",
            "3. low": "138.6200",
            "4. close": "160.8600",
            "5. volume": "456395986"
        },
        "2018-10-31": {
            "1. open": "165.9200",
            "2. high": "165.9500",
            "3. low": "130.0600",
            "4. close": "142.2800",
            "5. volume": "544315498"
        },
        "2018-09-28": {
            "1. open": "173.5000",
            "2. high": "173.9500",
            "3. low": "152.8500",
            "4. close": "164.7600",
            "5. volume": "433318007"
        },
        "2018-08-31": {
            "1. open": "186.0000",
            "2. high": "189.0600",
            "3. low": "165.3900",
            "4. close": "175.0100",
            "5. volume": "605664280"
        },
        "2018-07-31": {
            "1. open": "181.6600",
            "2. high": "198.3500",
            "3. low": "181.0600",
            "4. close": "187.2300",
            "5. volume": "321804405"
        },
        "2018-06-29": {
            "1. open": "199.5000",
            "2. high": "211.7000",
            "3. low": "182.0400",
            "4. close": "185.5300",
            "5. volume": "408887733"
        },
        "2018-05-31": {
            "1. open": "177.5800",
            "2. high": "202.2800",
            "3. low": "175.7700",
            "4. close": "198.0100",
            "5. volume": "412790720"
        },
        "2018-04-30": {
            "1. open": "182.8100",
            "2. high": "183.6300",
            "3. low": "166.1300",
            "4. close": "178.5400",
            "5. volume": "323617278"
        },
        "2018-03-29": {
            "1. open": "186.1800",
            "2. high": "201.5000",
            "3. low": "175.4500",
            "4. close": "183.5400",
            "5. volume": "382834746"
        },
        "2018-02-28": {
            "1. open": "192.7500",
            "2. high": "199.4900",
            "3. low": "168.8800",
            "4. close": "186.1400",
            "5. volume": "445029521"
        },
        "2018-01-31": {
            "1. open": "176.3990",
            "2. high": "206.2000",
            "3. low": "175.7000",
            "4. close": "204.2900",
            "5. volume": "445133368"
        },
        "2017-12-29": {
            "1. open": "175.2700",
            "2. high": "180.6800",
            "3. low": "164.2500",
            "4. close": "172.4300",
            "5. volume": "416245893"
        },
        "2017-11-30": {
            "1. open": "187.8800",
            "2. high": "191.7500",
            "3. low": "173.6200",
            "4. close": "177.0800",
            "5. volume": "419971772"
        },
        "2017-10-31": {
            "1. open": "174.5700",
            "2. high": "185.1200",
            "3. low": "168.5800",
            "4. close": "184.8900",
            "5. volume": "336826574"
        },
        "2017-09-29": {
            "1. open": "171.9900",
            "2. high": "180.8700",
            "3. low": "166.7900",
            "4. close": "172.7100",
            "5. volume": "363011700"
        },
        "2017-08-31": {
            "1. open": "156.2500",
            "2. high": "177.0000",
            "3. low": "147.5000",
            "4. close": "171.7400",
            "5. volume": "468981719"
        },
        "2017-07-31": {
            "1. open": "141.7500",
            "2. high": "160.3900",
            "3. low": "139.4950",
            "4. close": "154.9500",
            "5. volume": "271729551"
        },
        "2017-06-30": {
            "1. open": "122.8200",
            "2. high": "148.2900",
            "3. low": "122.2600",
            "4. close": "140.9000",
            "5. volume": "544291336"
        },
        "2017-05-31": {
            "1. open": "115.6300",
            "2. high": "126.4000",
            "3. low": "114.0000",
            "4. close": "122.4600",
            "5. volume": "277875098"
        },
        "2017-04-28": {
            "1. open": "108.8500",
            "2. high": "115.9900",
            "3. low": "106.7600",
            "4. close": "115.5000",
            "5. volume": "171508241"
        },
        "2017-03-31": {
            "1. open": "103.6800",
            "2. high": "110.4500",
            "3. low": "102.1000",
            "4. close": "107.8300",
            "5. volume": "205435679"
        },
        "2017-02-28": {
            "1. open": "102.0700",
            "2. high": "105.2000",
            "3. low": "100.0200",
            "4. close": "102.9000",
            "5. volume": "160485323"
        },
        "2017-01-31": {
            "1. open": "89.0000",
            "2. high": "104.5700",
            "3. low": "88.0800",
            "4. close": "101.3100",
            "5. volume": "239134550"
        },
        "2016-12-30": {
            "1. open": "94.0000",
            "2. high": "94.0550",
            "3. low": "86.0100",
            "4. close": "87.8100",
            "5. volume": "218082487"
        },
        "2016-11-30": {
            "1. open": "100.4300",
            "2. high": "104.1000",
            "3. low": "87.8800",
            "4. close": "94.0200",
            "5. volume": "330513400"
        },
        "2016-10-31": {
            "1. open": "105.4500",
            "2. high": "109.0000",
            "3. low": "99.0000",
            "4. close": "101.6900",
            "5. volume": "240078790"
        },
        "2016-09-30": {
            "1. open": "97.3000",
            "2. high": "109.8700",
            "3. low": "97.0000",
            "4. close": "105.7900",
            "5. volume": "420541516"
        },
        "2016-08-31": {
            "1. open": "82.7900",
            "2. high": "98.8600",
            "3. low": "82.5900",
            "4. close": "97.1900",
            "5. volume": "450521042"
        },
        "2016-07-29": {
            "1. open": "79.1200",
            "2. high": "85.0000",
            "3. low": "77.6800",
            "4. close": "82.4800",
            "5. volume": "205159741"
        },
        "2016-06-30": {
            "1. open": "79.1500",
            "2. high": "80.1400",
            "3. low": "73.3000",
            "4. close": "79.5300",
            "5. volume": "375800595"
        },
        "2016-05-31": {
            "1. open": "76.8900",
            "2. high": "82.0300",
            "3. low": "74.1200",
            "4. close": "82.0000",
            "5. volume": "376860709"
        },
        "2016-04-29": {
            "1. open": "78.2400",
            "2. high": "85.8900",
            "3. low": "75.6600",
            "4. close": "76.9400",
            "5. volume": "215841293"
        },
        "2016-03-31": {
            "1. open": "70.0200",
            "2. high": "79.8400",
            "3. low": "69.8600",
            "4. close": "79.0300",
            "5. volume": "231331767"
        },
        "2016-02-29": {
            "1. open": "66.5000",
            "2. high": "70.5800",
            "3. low": "59.2500",
            "4. close": "68.8100",
            "5. volume": "314493127"
        },
        "2016-01-29": {
            "1. open": "78.1800",
            "2. high": "78.6800",
            "3. low": "65.3400",
            "4. close": "67.0300",
            "5. volume": "350723599"
        },
        "2015-12-31": {
            "1. open": "83.7700",
            "2. high": "85.8200",
            "3. low": "78.9900",
            "4. close": "81.2700",
            "5. volume": "313842645"
        },
        "2015-11-30": {
            "1. open": "83.5200",
            "2. high": "86.4200",
            "3. low": "75.6400",
            "4. close": "84.0800",
            "5. volume": "465918043"
        },
        "2015-10-30": {
            "1. open": "59.5000",
            "2. high": "84.4400",
            "3. low": "58.2000",
            "4. close": "83.8300",
            "5. volume": "387907533"
        },
        "2015-09-30": {
            "1. open": "64.5800",
            "2. high": "68.0800",
            "3. low": "57.2000",
            "4. close": "58.9700",
            "5. volume": "455063420"
        },
        "2015-08-31": {
            "1. open": "78.2000",
            "2. high": "80.9900",
            "3. low": "58.0000",
            "4. close": "66.1200",
            "5. volume": "381205945"
        },
        "2015-07-31": {
            "1. open": "82.6000",
            "2. high": "85.3800",
            "3. low": "76.2100",
            "4. close": "78.3400",
            "5. volume": "255379375"
        },
        "2015-06-30": {
            "1. open": "90.0900",
            "2. high": "91.6000",
            "3. low": "80.8000",
            "4. close": "82.2700",
            "5. volume": "248091060"
        },
        "2015-05-29": {
            "1. open": "81.0300",
            "2. high": "95.0600",
            "3. low": "77.7700",
            "4. close": "89.3200",
            "5. volume": "457067741"
        },
        "2015-04-30": {
            "1. open": "83.3700",
            "2. high": "87.6900",
            "3. low": "80.4399",
            "4. close": "81.2900",
            "5. volume": "336957763"
        },
        "2015-03-31": {
            "1. open": "85.0000",
            "2. high": "87.0400",
            "3. low": "80.0300",
            "4. close": "83.2400",
            "5. volume": "388629425"
        },
        "2015-02-27": {
            "1. open": "91.1300",
            "2. high": "91.8800",
            "3. low": "83.8800",
            "4. close": "85.1200",
            "5. volume": "253882675"
        },
        "2015-01-30": {
            "1. open": "104.2400",
            "2. high": "105.3399",
            "3. low": "87.3600",
            "4. close": "89.0800",
            "5. volume": "379525849"
        },
        "2014-12-31": {
            "1. open": "110.0200",
            "2. high": "111.6800",
            "3. low": "101.2000",
            "4. close": "103.9400",
            "5. volume": "355328508"
        },
        "2014-11-28": {
            "1. open": "99.6700",
            "2. high": "120.0000",
            "3. low": "99.0500",
            "4. close": "111.6400",
            "5. volume": "772586459"
        },
        "2014-10-31": {
            "1. open": "88.7000",
            "2. high": "100.6700",
            "3. low": "82.8100",
            "4. close": "98.6000",
            "5. volume": "441708953"
        }
    }
}

const data = pricesBABA;

function Valuation(props) {

    // TODO Normalize Price Data, date formats are not the same

    let prices = pricesBABA["Monthly Time Series"]
    console.log(prices);

    let annualEarnings = props.earningsData.annualEarnings.filter(entry => pricesBABA["Monthly Time Series"][entry.fiscalDateEnding] !== undefined);;
    let quarterlyEarnings = props.earningsData.quarterlyEarnings.filter(entry => pricesBABA["Monthly Time Series"][entry.fiscalDateEnding] !== undefined);

    annualEarnings.forEach(entry => entry.price = pricesBABA["Monthly Time Series"][entry.fiscalDateEnding]["4. close"])
    annualEarnings.forEach(entry => entry.pe = entry.price / entry.reportedEPS);
    console.log(annualEarnings);

    quarterlyEarnings.forEach(entry => entry.price = pricesBABA["Monthly Time Series"][entry.fiscalDateEnding]["4. close"])
    quarterlyEarnings.forEach(entry => entry.pe = entry.price / 4 / entry.reportedEPS);
    console.log(quarterlyEarnings);

    function analyze() {

    }

    analyze();

    return (
        <div className="App-core">
            <h2>Valuation</h2>
            <h3>PE</h3>
            <table>
                <tbody>
                <tr>
                    <th>Year</th>
                    <th>PE</th>
                </tr>
                {annualEarnings.map(entry =>
                    <tr key={entry.fiscalDateEnding}>
                        <td>{entry.fiscalDateEnding.slice(0, 4)}</td>
                        <td>{Math.trunc(entry.pe)}</td>
                    </tr>
                )}
                <tr>
                    <th>Quarter</th>
                    <th>PE</th>
                </tr>
                {quarterlyEarnings.map(entry =>
                    <tr key={entry.fiscalDateEnding}>
                        <td>{entry.fiscalDateEnding}</td>
                        <td>{Math.trunc(entry.pe)}</td>
                    </tr>
                )}
                </tbody>
            </table>
        </div>
    )
}

export default Valuation;